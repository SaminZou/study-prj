```yaml
title: 服务器运维知识🚀
author: samin
date: 2021-04-08
```

# 关于备份

- 按对应用的运行影响分
    - Hot backup （热备） 在线备份，对应用运行没有任何影响

    - Cold backup （冷备） 也叫离线备份，需要停机

    - warm backup（暖备） 应用级实现，一般会加锁暂停服务，交互方面较冷备会有对应的提示。

- 按备份后的产物分
    - 逻辑备份 需要应用支持，如MySQL提供的`mysqldump`指令，备份后的产物是sql语句，备份还原时间较长

    - 物理备份 直接拷贝数据库的物理文件

- 按备份的内容分
    - 全量备份

    - 增量备份

    - 日志备份、主从备份

# 服务器性能主要看

- CPU 核数及主频

- Memory 大小

- IO 速度

- Network 情况

# 正式库生产环境

- 一个IP最好只有一个类型的应用

- 正式库数据库不要记住密码，测试库记住密码

- 删改数据需要谨慎，提前做好备份

- 一个tomcat最好只部署一个任务，重启更新不会互相影响，方便问题排查

- 解决动态更改数据库配置：1.maven中pom配置，打包的时候选择环境；2.使用jndi，在tomcat中配置

# 虚拟服务器

- esxi 提供了很多保障，如热备、宕机回复等

- 阿里云可以为服务器提供很多保障，不需要担心数据丢失、物理机损坏等问题

# 服务器经常宕机

1. 项目是否报错，查看 tomcat log 文件，查看项目 log 文件

1. 使用工具（类似 jvisualvm.exe ）查看 GC 情况，堆栈情况

1. 中间件是否配置有问题，查看 mysql 慢查询日志，查看中间件是否宕机，nginx 错误日志

1. 服务器是否卡死，使用 top 指令查看服务器性能，查看服务器日志 '/var/log'

1. 网络是否有问题

# 应用上线前期规划

- 服务器性能指标

    - CPU

    - 内存

    - 网络

    - I/O

    - GPU

- 服务器其他指标

    - 容量

    - 网卡

- 服务器数量

- 服务器预算

# 线上问题排查常用指令集合

- 磁盘空间问题排查

df -h

du -sh *

- CPU 与内存使用率过高问题

top

top -p [port] -H

free -h

swapon

- 网络延迟

netstat -a

netstat -tnpa

ps -ef

iftop -P

- Java 程序的问题分析

jmap -dump 分析堆内存中的快照

jmap -heap 查看堆内存的设置与当前使用情况

jstack

# 调试工具推荐

阿里的 arthas

- watch

- trace

- dashboard

- thread

- thread -b

- jad 
  
- ognl