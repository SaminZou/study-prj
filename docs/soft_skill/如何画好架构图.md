```yaml
title: 如何画好架构图
author: samin
date: 2021-07-06
```

# Enterprise Architecture （EA 企业架构）

有两种常见架构方法RUP和TOGAF，这两个框架也是我们常常了解架构分类的两个维度。从现实世界到业务模型，从业务模型到概念模型，从概念模型到设计模型，通过不断的抽象去粗取精，形成对现实世界的层层抽象，所以架构的过程其实就是建模的过程。在不同的抽象角度、不同的抽象层次，根据分工的不同会有不同的核心业务活动、不同的核心实体、边界的确定关键在寻找核心的生命周期。前边我们基本说清楚了抽象的角度、层次和边界，从三个维度确定了抽象的结果。

# 架构图是什么

架构图 = 架构 + 图 = 架构的表达 = 表达架构的图

## 图是什么

图是一种信息的表达方式

## 架构是什么

让我们认识到一种现象，把复杂系统拆分成模块，似乎并没有降低整个系统的复杂度。它降低的只是子系统的复杂度。而整个系统的复杂度，反而会由于拆分后的模块之间，不得不进行交互，变得更加复杂。

架构体现的是整体结构和组件之间的关系。

# 架构的本质

- 架构的本质是为了管理复杂性

- 对系统进行有序化重构，不断减少系统的 ”熵”，使系统不断进化
  
- 对系统进行有序化重构，以符合当前业务的发展，并可以快速扩展

> 核心：管理复杂性，效率最大化

# 如何表达

架构的过程其实就是建模的过程

## 什么是建模

建模就是建立模型，就是为了理解事物而对事物做出的一种抽象，是对事物的一种无歧义的书面描述。

建模（Modeling），是指通过对客观事物建立一种抽象的方法用以表征事物并获得对事物本身的理解，同时把这种理解概念化，将这些逻辑概念组织起来，构成一种对所观察的对象的内部结构和工作原理的便于理解的表达。

## 如何建模

### 业务建模

核心的套路是：谁？用什么样的服务/功能/能力？解决什么样的问题？从而刻画出：参与者角色、系统能力、交互关系，需要常常问自己的是：边界是什么？输入输出是什么？逐步的通过用例来梳理出业务功能，形成角色—>主流程—>分支流程，进而通过不断的归纳演绎形成最终的业务抽象描述“一张图”。

一个小的细节是不能妄图通过这些过程迅速在大脑里完成大图的绘制，还是需要从小的环节做起，把一部分小的业务闭环做成一个个的小组块，不要让它再占用大脑的空间，然后逐步的整体思考和把握，渐进式的形成大图；与此同时，大图的样式美观先完全忽略，走通逻辑再细致调整。之所以强调这个细节，是因为尝试通过“一张图”去描述一个非常大的业务本身就是件很有挑战的事情，如果不这么做容易让自己变得焦虑和急躁，这是一个慢功夫，需要耐心，需要在关键阻塞的地方慢下来，甚至一遍一遍的反复才能最终完成。

1. 大量信息输入，同时探求可能性；归类汇总，形成大图；规定边界，确认输入输出

2. 思考系统的使用者；思考业务的主流程和分支流程；归纳演绎抽象成业务描述

3. 业务、产品、测试、研发达成共识，减少沟通成本

### 系统建模

通过业务建模完成了从现实世界到业务模型的构建，在此基础上，如何通过抽象完成业务模型到设计模型的映射，这是系统建模要解决的问题。从研发实现的角度，这个阶段会产出各种各样的模型图，比如实体模型图、时序图、状态图、各个层次的架构图等等，但是无论何种角度，何种层次，系统建模一定是在业务建模的基础上，完成业务需求到系统模型之间的映射；这其中涉及业务功能到系统能力、业务流程到数据流程的映射；系统建模更强调职责、依赖、约束关系，用于指导研发的落地实现。


- “剥洋葱式”的由大到小，由粗到细，覆盖所有已知和未来可能业务场景；善于利用各种模型表述：自然语言、关系模型、时序图、状态图、流程图、各种层次架构图等等进行模型表述，充分表达各种业务场景并不断验证

- 核心实体抽取：抓住核心概念，核心关系完成核心模型建立

    - 对象分析法
    
    - 用例分析法
    
    - 问题分析法

- 终极武器：所有的设计/逻辑模糊的点，将所有已知场景分别套入，自己讲给自己

## 总结


- 业务建模中“把书读薄”归类汇总，建立「大局观」，形成大图，这里按什么维度去归类？如何判断归类是正确的？

- 系统建模中“剥洋葱”怎么拆？按什么拆？上述架构图中的层次、领域如何划分层次？边界在哪里？

# 抽象

## 定义

从具体事物抽出、概括出它们共同的方面、本质属性与关系等，而将个别的、非本质的方面、属性与关系舍弃，这种思维过程，称为抽象。

## 抽象的角度

- 抽象角度其实也是分类的角度，角度不同，会导致完全不同建模方向和结果

- 抽象的角度就是建模的方向和目的（“屁股决定脑袋”）

## 用例

1. 我的 5 月 18 日的《旧金山纪事报》
2. 5 月 18 日的《旧金山纪事报》
3. 《旧金山纪事报》
4. 一份报纸
5. 一个出版品

## 抽象依据

- 以抽象角度分层（可能一层是多角度的聚合）
  
- 面对变化分层（用层次隔离变化）

## 抽象原则

- 公用的往下走 

- 个性的往上走

- 下层可以独立于上层存在 
  
- 控制下层的变化

## 抽象的边界

核心业务活动、核心实体、核心实体生命周期

在不同的抽象角度、不同的抽象层次，根据分工的不同会有不同的核心业务活动、不同的核心实体、边界的确定关键在寻找核心的生命周期。寻找生命周期的过程，就是发现内聚的过程；将所有关于生命周期的业务活动累积，就可以提升领域或模块的内聚性。

## 抽象的评估

高内聚，低耦

>耦合是软件结构中各模块之间相互连接的一种度量 
>内聚是一个模块内部各成分之间相关联程度的度量

- 每次从一个角度来切分，然后换多个角度来审视

- 通过组合、拆分来精化、优化模型与设计（抽象的结果）
  
- 关键的审视点
  
- 耦合性：减少模块间通信量
  
- 内聚性：功能单一化
  
- 变化的隔离性：减少信息依赖，建隔离层、虚拟层

## 抽象的方法论（套路）

- 业务建模中“把书读薄”归类汇总，建立“大局观”，形成大图，这里按什么维度去归类？如何判断归类是正确的？

- 系统建模中“剥洋葱”怎么拆？按什么拆？上述架构图中的层次、领域如何划分层次？边界在哪里？

方法论：

- 抽象有两种方法，一种是自顶向下，另一种是自底向上

- 业务建模，是从小到大，从局部到整体，自底向上的归纳、演绎的抽象过程

- 系统建模，是从大到小，从整体到局部，自顶向下的拆解、切分的抽象过程

- 但不绝对，自上而下和自下而上，往往在过程中是随意切换的

# 如何画好一张架构图

## 画架构图是为了什么

- 解决沟通障碍：达成共识、减少歧义。

- 提升协作效率：团队内部和团队之间的协作、沟通、愿景和指导。

> A picture is worth a thousand words

架构图的使用者：

- 参与项目的各团队各角色（业务、产品、开发、测试、安全、GOC）
  
- 项目之外的客户（外部客户，外部评审专家）
  
- 各层次 TL（汇报，跨 BU，跨团队协作沟通）

## 怎么画

- 较低层次的抽象：应用内部包图、类图；某个领域：实体图、时序图、状态图、用例图等等

- 较高层次的抽象：具有一定的复杂性，比如微服务架构，系统间的交互图，领域/子领域架构图，整个系统架构图等等

架构图的粒度、类别、内容可以逐步的去完善，去粗取精，迭代优化

## 构图

使用 UML

## 如何评判架构图的好坏

- 内容术语一致、信息粒度大小一致，图例清晰，颜色类型统一，美观

- 图中的信息与相应的抽象级别相关，且满足利益相关者(合作方)的需求

- 一张好的架构图不需要多余的文字解释！受众有没有准确接收到想传递的信息；如果它所导致的疑问比它能解释的问题还要多，那么它就不是一张好的架构图

- 架构图应该帮助每个人看到大局，了解周围的环境，适当的上下文信息

- 架构图应该避免“只见树木，不见森林”

> 是否符合 “高内聚，低耦合”

# 架构师的样子

- 快速学习

- 不要屁股决定脑袋

- 提升思考能力和对于技术原理或本质的理解

- 能够在业务和系统间权衡落地

## 好的架构师画像

- 先选一个好的挑战，为了创造价值，这个挑战不是技术挑战，而是为了解决什么样的用户痛点，用户问题。要对业务有很好的了解

- 把简单的东西想复杂，为了控制好风险和准备好未来

- 把复杂的东西做简单，为了做好产品且控制好成本

- 最后把**复杂的东西讲简单，为了做好传承**

## 反例画像

- 选一个不值得做的问题

- 把复杂的问题想简单

- 把简单的东西做复杂

- 把简单的东西讲复杂
