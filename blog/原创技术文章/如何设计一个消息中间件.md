```yaml
title: 如何设计一个消息中间件
type: self-made_interview_questions
author: samin
date: 2021-09-04 
```

# 重要

讲清楚消费者、生产者、中间件三者之间的基本设计，尽可能考虑到结合业务场景产生的问题、部署应用问题等解决方案

# 问题相关要点

1. 首先这个mq得支持可伸缩性吧，就是需要的时候快速扩容，就可以增加吞吐量和容量，那怎么搞？设计个分布式的系统呗，参照一下kafka的设计理念，broker -> topic -> partition，每个partition放一个机器，就存一部分数据。如果现在资源不够了，简单啊，给topic增加partition，然后做数据迁移，增加机器，不就可以存放更多数据，提供更高的吞吐量了？

2. 考虑mq的数据要不要落地磁盘，那肯定要了，落磁盘，才能保证别进程挂了数据就丢了。那落磁盘的时候怎么落？顺序写，这样就没有磁盘随机读写的寻址开销，磁盘顺序读写的性能是很高的，这就是kafka的思路。

3. 考虑mq的可用性，参考kafka的高可用保障机制。多副本 -> leader & follower -> broker挂了重新选举leader即可对外服务。

4. 能不能支持数据0丢失啊？可以的，参考kafka数据零丢失方案

> 其实一个mq肯定是很复杂的，面试官问你这个问题，其实是个开放题，他就是看看你有没有从架构角度整体构思和设计的思维以及能力。
