```yaml
title: 数据库设计是否需要外键
author: samin
date: 2021-10-04
```

# 应用场景

外键是否采用看业务应用场景，以及开发成本的，大致列下什么时候适合，什么时候不适合使用

1. 互联网行业应用不推荐使用外键： 用户量大，并发度高，为此数据库服务器很容易成为性能瓶颈，尤其受IO能力限制，且不能轻易地水平扩展；若是把数据一致性的控制放到事务中，也即让应用服务器承担此部分的压力，而引用服务器一般都是可以做到轻松地水平的伸缩

2.传统行业

- 软件应用的人数有限，换句话说是可控的

- 数据库服务器的数据量也一般不会超大，且活跃数据有限

综合上述2句话描述，也即数据库服务器的性能不是问题，所以不用过多考虑性能的问题；另外，使用外键可以降低开发成本，借助数据库产品自身的触发器可以实现表与关联表之间的数据一致性和更新；最后一点，使用外键的方式，还可以做到开发人员和数据库设计人员的分工，可以为程序员承担更多的工作量

# 外键可能影响性能问题

- 数据库需要维护外键的内部管理

- 外键等于把数据的一致性事务实现，全部交给数据库服务器完成

- 有了外键，当做一些涉及外键字段的增，删，更新操作之后，需要触发相关操作去检查，而不得不消耗资源

- 外键还会因为需要请求对其他表内部加锁而容易出现死锁情况

主键和索引是不可少的，不仅可以优化数据检索速度，开发人员还省不少其它的工作

# 结论

1. 在大型系统中（性能要求不高，安全要求高），使用外键；在大型系统中（性能要求高，安全自己控制），不用外键；小系统随便，最好用外键

2. 用外键要适当，不能过分追求

3. 不用外键而用程序控制数据一致性和完整性时，应该写一层来保证，然后个个应用通过这个层来访问数据库