```yaml
title: DB 和 Redis 数据一致性问题
author: samin
date: 2022-01-09
```

# DB 和 Redis 间的数据一致性问题

## 问题来源

使用缓存的目的无外乎缓解 DB 压力（主要是读压力），提升服务响应速度。引入缓存，就不可避免地引入了缓存与业务 DB 数据的一致性问题

## 产生问题的原因

尽量减少业务系统和基础服务的 RPC 接口调用方式，采用访问缓存服务方式替代 RPC 接口调用，这就需要缓存有数据准确性（实时）、数据完整性（全量、永久有效）、系统可用性三大特性，由于基础服务的访问量巨大，所以要求解决缓存与 DB 数据一致性问题

## 如何构建缓存系统

原则：可以重复更新，但不能漏更新

手段：定时任务扫描、业务系统 MQ、binlog 变更 MQ

## 区别

最终一致性场景的基本思路是：读缓存优先，数据可以容忍暂时不一致，因此重点在及时补偿。

强一致性场景的基本思路是：读 DB 优先，缓存仅作为“DB 降压”的辅助手段，在不确定缓存数据是否最新的情况下，宁可多查询几次 DB，也不要查询到缓存中的不一致数据。

> 最终一致性缓存方案是独立的缓存服务，而该强一致缓存方案，是需要嵌入到应用系统中去使用的