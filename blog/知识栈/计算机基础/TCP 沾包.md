```yaml
title: TCP 沾包 
author: samin
date: 2021-05-23
```

> 粘包拆包问题是处于网络比较底层的问题，在数据链路层、网络层以及传输层都有可能发生。UDP有消息保护边界，UDP没有经过 Negal 算法优化，不会将多个小包合并一次发送出去，所以不存在沾包问题。本文讨论传输层中 TCP 协议的沾包处理。

# TCP 沾包是什么

![tcp沾包示意](https://raw.githubusercontent.com/SaminZou/pic-repo/master/Network/tcp沾包示意.png)

如图所示，2、3、4 为沾包的现象

# 发生的原因

1. 客户端写入的数据大于套接字缓冲区大小，这将会发生拆包。

2. 客户端写入数据小于套接字缓冲区大小，网卡将应用多次写入的数据发送到网络上，这将会发生粘包。

3. 进行MSS（最大报文长度）大小的TCP分段，当TCP报文长度-TCP头部长度>MSS的时候将发生拆包。

4. 接收方法不及时读取套接字缓冲区数据，这将发生粘包。

# 解决办法

1. 头部包含每个数据包的大小
   
2. 固定每个数据包的大小，不足部分可以用0填充
   
3. 数据包的首尾用特殊字符来界定