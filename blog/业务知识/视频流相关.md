```yaml
title: 视频流相关
author: samin
date: 2022-09-01
```

# 视频播放的本质

快速播放的图片而已

几个简单的概念：

- 帧：每帧代表一幅静止的图像
- 帧率（fps）：每秒显示的图片数。帧率越大，画面越流畅；帧率越小，画面越卡
  - 12 fps：由于人类眼睛的特殊生理结构，如果所看画面之帧率高于每秒约10-12帧的时候，就会认为是连贯的
  - 24 fps：有声电影的拍摄及播放帧率均为每秒24帧，对一般人而言已算可接受
  - 30 fps：早期的高动态电子游戏，帧率少于每秒30帧的话就会显得不连贯，这是因为没有动态模糊使流畅度降低
  - 60 fps：在实际体验中，60帧相对于30帧有着更好的体验
  - 85 fps：一般而言，大脑处理视频的极限

# 推流 VS 拉流

推流，指的是把采集阶段封包好的内容传输到服务器的过程。其实就是将现场的视频信号传到网络的过程。

拉流是指服务器已有直播内容，根据协议类型（如 RTMP、RTP、RTSP、HTTP 等），与服务器建立连接并接收数据，进行拉取的过程。

- RTMP Real-Time Messaging Protocol 实时消息传递协议

    - 低延迟
    - 适应性强
    - 灵活性（支持整合文本、视频和音频）支持 MP3 和 AAC 音频，也支持 MP4、FLV 和 F4V 视频

![](https://img-blog.csdnimg.cn/img_convert/0fc7da2dd5b4da5e81f11e7378ef6a87.png)

- RTSP Real-Time Streaming Protocol 实时流协议

![](https://img-blog.csdnimg.cn/img_convert/8c0cb8f228fe11c800b78e69fa87452a.jpeg)

    - 可以通过结合不同的协议来开发自己的视频流解决方案
    - 分段流式传输

RTSP 旨在建立和维护原始数据源（客户端）和流服务器之间的连接，允许控制流媒体服务器内的娱乐和通信系统

# 知识点

协议：rtsp、rtp、rtmp、hlv、http-flv

视频格式（封装格式，容器，包含了音视频文字等）：mp4、flv

编码格式：H.264、H.265
- 目的是压缩视频体积
- 帧内编码：压缩图片
- 帧间编码：利用两帧之间的局部不变性复用资源

工具：VLC（用于测试视频流是否可以播放）、FFmpeg 视频处理工具

# 使用快照视频服务器的原因

多请求摄像头无法同时提供响应

![](https://www.linkingvision.cn/sites/default/files/inline-images/2.PNG)

# 网站常见视频格式 flv 优点

- 文件体积小
- 便于传输、共享

# ffmpeg

通俗概括来说，ffmpeg是一个免费的开源程序库，一个命令行工具软件，专门用来编辑处理各种音视频或图像。 它不像之前说的那些编辑软件那样有着各种需要另外学习的操作界面。ffmpeg 于 Linux 系统中开发，不过在其它操作系统中都可以运行

操作视频流数据的命令行工具

[下载地址](https://ffmpeg.org/download.html)

## rtsp to mp4 file

$ ./ffmpeg.exe -y -i rtsp://username:passwd@127.0.0.1:554/h264/ch1/main/av_stream -vcodec copy -f mp4 test.mp4

## rtsp to flv file

$ ./ffmpeg.exe -y -i rtsp://username:passwd@127.0.0.1:554/h264/ch1/main/av_stream -vcodec libx264 -f flv -an test.flv

## rtsp to 

vcodec：视频编解码器设置

an：关闭声音数据接收

# 常见直播方案

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6391702cd44a49daa99f165c02a1ecf1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image)

# 通用摄像头定义标准

GB28181