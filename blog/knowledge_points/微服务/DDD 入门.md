```yaml
title: DDD 入门
author: samin
date: 2022-02-15
```

# DDD 是什么

软件架构设计方法论，类似的还有 TOGAF、COBIT、CGEIT

DDD 的体现是业务模型

DDD 是为了解决快速变化、复杂系统设计问题的

![](https://raw.githubusercontent.com/SaminZou/pic-repo/master/BlogPicture/DDD总览.jpg)

# DDD 开发过程

1. 概念设计
  - 概念关联图
  - 概念类
  - 领域类图
  - 填充属性

2. 逻辑设计
  - 业务逻辑
  - 业务模型

3. 物理设计
  - 开发
  - 重新定义
  - 数据存储问题
  - 架构风格

# DDD 与微服务的关系

微服务架构问题面临最大问题：微服务的“微”到底应该怎么拆？拆多小？

DDD 为微服务这两个问题带来了指导性的思想

# 对团队项目要求

1. 技术要求特别高，业务熟悉

2. 其他角色要求也特别高

3. 项目要有一定体量

# 传统开发带来的问题

> 根据业务进行数据库建表，定义表字段，新建持久化对象进行业务代码开发

- 随着业务变化，字段会不停修改
- 对象的增加会导致代码耦合度增加
- 无法满足敏捷开发的节奏

# DDD 用什么方式进行边界定义

1. 战略设计
  从业务角度出发，建立**业务模型**，划分业务边界

2. 战术设计
  根据业务模型进行**技术实现**，完成软件的开发以及落地

# 两类数据

领域模型中存在两类数据，一种是基础数据，性格内向；一种是业务数据，性格外向。业务数据可以让基础数据（实体）彼此关联起来，有点催化剂的感觉。所以建模的前提条件是：分清楚基础数据、业务数据。

# 元素

- 领域

- 子域
  - 核心子域
  - 通用子域
  - 支撑子域

- 通用语言

- 限界上下文

# 领域

一个领域本质上可以理解为一个问题域。只要是同一个领域，那问题域就相同

例如传统电商领域的问题无法就是订单、商品、物流、支付、库存等

# 子域

细分的领域，甚至可以把子域进行更加细分，分成更多子域

例如电商平台看作领域，那么订单，仓储，物流都可以是子域，而仓储还可以分为本地仓库、三方仓库、异地仓库

## 核心子域

> 由于预算、人力原因，一般研发模块会有侧重点

整个业务系统的核心，所有的业务都要围绕着核心业务域进行

如何明确业务核心？

精炼业务域，一个持续的过程

如何精炼业务域？

- 领域愿景说明（Domain Vision Statement）
- 突出核心（Highlighted Core）
- 内聚机制（Cohesive Mechanism）
- 分离的核心（Segregated Core）
- 抽象核心（Abstract Core）

## 通用子域

整个领域都能够用到的子域

## 支撑子域

不包含核心竞争力的功能，也不包含通用功能，但又是必须的支撑

# 通用语言

能够正确的，简单的，清晰的表达业务。并让项目参与人员都能够达成共识的语言

# 限界上下文

解决通用语言存在的语义问题

例：苹果不大好吃，可以理解为“苹果不大，好吃”，也可以理解为“苹果不大好吃”

用来封装通用语言和领域对象，提供上下文环境，保证在领域内的一些术语、业务相关对象等（通用语言）有一个确切的含义，没有二义性。这个边界定义了模型的使用范围

例：苹果不大好吃，下次再也不买了

# 战略设计

其实是一种用高层视野审视软件系统的方式

## 问题

- 建模方式
- 频繁的进行战略改动（出现这种方式不建议使用 DDD，因为核心域无法确定）

## 建模方式

### 四色模型

对于领域而言，模型关系神马的，这一堆高大上的玩意，都可以抽象为「四色原型」，就像无论什么人，都可以用几个标签来概括他。那么，何谓四色？简而言之就是：什么人的角色、在什么地方的角色、用什么东西的角色、做了什么事。

### 限界纸笔法

### 事件风暴

# 领域模型

领域模型是对领域内的概念类或现实世界中对象的可视化表示

业务对象模型：业务对象之间的引用关系

业务对象：3种

1. 业务角色：表示一个角色以及它所承担的一系列职责

收银员，计算商品总价、收钱、找零、退换货

2. 业务实体：表示与业务角色交互时所需的控件、资源、事件

电商项目中的商品、发票

3. 业务用例：表示业务角色与业务实体之间如何执行工作流程

业务链路、测试用例

业务对象模型：就是业务逻辑流程过程中所有角色，设置包括业务逻辑流转本身

## 4种实现

### 失血模型

> 不符合面向对象编程

特点：对象中只包含 get set 方法

优点：简单

缺点：
1. 臃肿的业务代码逻辑，耦合度高，难以理解、难以维护
2. 无法应对频繁更变的需求

### 贫血模型（最常用）

- 固有行为（不需要持久化）

如人睡觉走路等能力

- 非固有行为（需要和数据库进行持久化交互）

如人后天打游戏弹钢琴等能力

优点：
1. 层次结构清晰，各层级单向依赖
2. 对于只有少量业务逻辑的应用来说，使用起来非常自然
3. 开发非常迅速，易于理解

缺点：
1. 无法良好的应对非常复杂的逻辑及场景

### 充血模型

应用领域：保险

优点：
1. 更加符合面向对象原则 oop
2. 业务逻辑层很薄，符合单一职责原则

缺点：
1. 职责不好划分，对开发者要求高
2. 模型中包含大量的操作，实例化的时候增加很多不必要的操作

### 胀血模型

优点：
1. 简化了分层架构
2. 符合面向对象原则

缺点：
1. 取消了业务逻辑层，直接在 Domain Object 封装事务和授权，授权很多原本不属于这个领域对象的逻辑，模型不稳定

# 三层架构

三层架构和 MVP 模式是两种概念

分层架构设计为了帮助我们达到高内聚低耦合，到达代码的复用性、拓展性设计

表现层（ Controller / "Service"）、业务逻辑层( Service )、数据访问层( Dao / Mapper )

# 四层架构

更适合 DDD 方式设计的软件系统开发代码架构

用户界面层（ User Interface ）
应用层（ Application ）
领域层（ Domain ）
基础实施层（ Infrastructure ）

- 严格分层架构（ 三层架构，严格按照从上到下访问 ）
- 松散分层架构（ 四层架构，无顺序依赖 ）

# MVC 模式

缺点：

1. 导致控制器冗余
2. 控制器对于对象依赖过重
3. 对象之间产生耦合
4. 由于 Spring 的存在，其实我们的开发是不符合面向对象的

MVC 模式本质上和 DDD 有冲突，MVC 模式的设计理念是把由行为驱动

# DCI 模式

对于 MVC 模式的补充，面向对象量化落地

Data 对象数据
Context 对象场景
Interactions 交互

契合 DDD 落地

> DCI 架构模式是架构设计层面的方法论 
> 四色建模法等是需求层面的方法论

# 包结构差异

## MVC

controller
service
dao

## DCI

domain
service

> 软件那么多年，最主要的一个本质是复用，难点在封装变化

# 防腐层隔离变化

说白了就是把可能会变化的代码抽离形成一个 service 类
