```yaml
title: 联表操作的业务开发建议 
author: samin
date: 2021-02-18
```

# 背景

对于稍微复杂的业务开发，绕不开需要联表查询数据的操作，对于业务系统的开发，一般有两种做法：

1. 单表查询 + 代码处理

2. 联表 SQL

# 不推荐联表 SQL 的原因

1. 尽量减少数据库的计算压力，让数据库专注持久化

2. 效率低

3. 不熟悉SQL的前提下导致灵活度差

# 推荐 单表查询 + 代码处理 的原因

1. 单表查询更利于后续的维护

在实际开发场景中，在代码初步开发阶段，业务发生变动，某张表的结构发生变动，很可能整个join查询都变得不可用，复杂的关联查询，在修改时，基本等于推倒重来。
但是如果我们使用了单表查询，拆成上诉例子中的三个步骤，我们可能只需要修改其中的一个步骤即可，比较利于维护。

2. 代码可复用性高

join的SQL基本上是不能够被复用的

3. 效率问题

join联表查询，小表驱动大表，通过索引字段进行关联。如果表记录比较少的话，效率还是OK的，有时效率超过单表查询。但是如果数据量上去，多表查询是笛卡尔乘积方式，需要检索的数据是几何倍上升的。另外多表查询索引设计上也考验开发者的功底，索引设计不合理，大数据量下的多表查询，很可能把数据库拖垮。
相比而言，拆分成单表查询+代码上组装，业务逻辑更清晰，优化更方便，单个表的索引设计上也更简单。用多几行代码，多几次数据库查询换取这些优点，还是很值得的。

4. 减少冗余字段的查询

在很多业务中，我们可能对某条记录只需要查询一次，此时如何使用关联查询，则不可避免的需要重复地访问一部分数据，从而可能会加剧网络和内存的消耗。

5. 缓存利用率更高

可以结合缓存框架，缓存常用的SQL，提交代码整体执行效率，减少库表操作。联表SQL则高度耦合导致无法分开缓存不必要的冗余数据。

6. 其他

数据库资源比较宝贵，很多系统的瓶颈就在数据库上，很多复杂的逻辑我们在Service做，不在数据库处理会更好。
在后续数据量上去，需要分库分表时，Join查询更不利于分库分表，目前MySQL的分布式中间件，跨库join表现不良。
单表查询+代码上组装相当于解耦，现在开发中，我们常常使用各种ORM框架，不知道你的联查orm给你搞成了什么样,你是很难直接优化。