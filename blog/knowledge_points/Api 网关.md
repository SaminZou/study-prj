```yaml
title: Api 网关
author: samin
date: 2021-07-15
```

# API 的定义

一个明确定义和目的型接口，通过网络调用，使软件开发人员能够以受控且方便的方式，对组织内的数据和功能进行编程访问。

这些接口抽象了实现它们的技术架构细节。对于这些设计的网络端点，我们希望获得一定程度的**文档、使用指南、稳定性和向后兼容性。**

# API 管理

试图解决“何时公开现有的API供他人使用”的问题，如何跟踪谁使用这些API，实施关于允许谁使用它们的政策，建立安全流程来进行身份验证和授权许可，同时创建一个服务目录（该目录可在设计时使用以促进API使用，并为有效治理奠定基础）。

可以完成以下特性：在给定时间范围内，在指定价格点上，每个端点每个用户的调用次数

在网关层，我们可以执行身份验证，速率限制，指标收集，其它策略执行等操作

> 别让任何**业务逻辑**进入这一层。如前一段所述，API管理是共享的基础结构，但是由于我们的API流量经过了它，因此它倾向于重新创建“大包大揽的全能型”（认为是企业服务总线）网关，这会导致我们必须与之协调来更改我们的服务。

## 成熟的 API 管理网关

- Google Cloud Apigee
  
- Red Hat 3Scale
  
- Mulesoft
  
- Kong

# 集群入口

类似 K8S 的 Ingress ， 是控制不仅仅 SVC 的流量，包括了gRPC服务，缓存、消息队列、数据库等流量

## 成熟的集群入口

- HAProxy

- OpenShift’s Router (based on HAProxy)

- NGINX

- Traefik

- Kong

此层级的集群入口控制器由平台团队操作，但是，这部分基础架构通常与更加去中心化的、自助服务工作流相关联（正如您对云原生平台所期望的那样）

# API 网关模式

微服务模式中的 API Gateway Pattern，API网关模式是针对不同类别的消费者来优化API的使用

这个优化涉及一个API间接访问。您可能会听到另一个代表API网关模式的术语是“前端的后端”，其中“前端”可以是字符终端（UI）、移动客户端、IoT客户端甚至其它服务/应用程序开发人员。

在API网关模式中，我们明显简化了一组API的调用，以模拟针对特定用户、客户端或使用者的“应用程序”内聚API。回想一下，当我们使用微服务构建系统时，“应用程序”的概念就消失了。API网关模式有助于恢复此概念。这里的关键是API网关，一旦实现，它将成为客户端和应用程序的API，并负责与任何后端API和其他应用程序网络端点（不满足上述API定义的端点）进行通信。

解决问题：

- 速率限制
  
- 身份验证/授权
  
- 断路
  
- 度量收集
  
- 流量路由

## 成熟的 API 网关模式

- Spring Cloud Gateway 

- Solo.io Gloo

- Netflix Zuul

- IBM-Strongloop Loopback/Microgateway

## 更通用的编程或集成语言框架

- Apache Camel

- Spring Integration

- Ballerina.io

- Eclipse Vert.x
  
- NodeJS

# 服务网格（ Service Mesh ）

在大规模和多种开发语言环境下，服务网格技术的出现提供了更好的解决方案。服务网格通过透明地实现为平台及其组成服务带来以下功能：

- 服务到服务（即东西向流量）的弹性

- 安全性包括最终用户身份验证、相互TLS、服务到服务RBAC / ABAC

- 黑盒服务的可观察性（专注于网络通信），例如请求/秒、请求延迟、请求失败、熔断事件、分布式跟踪等
  
- 服务到服务速率限制，配额执行等






