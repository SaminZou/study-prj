```yaml
title: 分布式锁 
author: samin
date: 2022-01-09
```

# 分布式特点

- 单点故障（Single Point Failure）

- 无状态

# 分布式锁和 JVM 锁异同

在可以使用两种锁的时候，分布式锁一定没有 JVM 性能好，因为有网络通讯的损耗

并不是有了分布式锁，就可以解决高并发问题，而忽略单机的 IO 问题了，所以需求尽量在先考虑 JVM 锁无法处理的情况下，再考虑分布式锁。因为使用分布式锁意味着一定用到了中间件，中间件承接太多请求，IO（系统调用） 吞吐量就会成为一个瓶颈。

![](https://raw.githubusercontent.com/SaminZou/pic-repo/master/BlogPicture/分布式锁和JVM锁1.png)

![](https://raw.githubusercontent.com/SaminZou/pic-repo/master/BlogPicture/分布式锁和JVM锁2.png)

并不是增加了机器，就可以理解为系统的性能整体提升了，就比如分布式锁的正确使用，以及为了做到服务无状态把一些本地数据放到中间件去共同访问等损耗。

同一个功能，分布式肯定比单机要慢。分布式的意义在于分治，间接可以提升速度。

只要用了锁，程序一定是串行化处理。

# 分布式锁实现方式

- MySQL
- Redis
- Zookeeper
- Etcd

# 两大类分布式锁

- 类 cas 自旋式分布式锁，询问的方式，尝试加锁
    - Redis * 
    - MySQL

- event 事件通知锁的变化，等待被告知
    - Zookeeper *
    - Etcd
    
Zookeeper 的分布式锁要比 Redis 可靠很多，但他繁琐的实现机制导致了它的性能不如 Redis，而且 ZK 会随着集群的扩大而性能更加下降。

# 尽量避免分布式锁

设计的时候，尽量使用队列，异步，响应式的方式绕开分布式锁，因为分布式锁的目的是让多资源通过串行的方式去工作

响应式编程可以提升资源性能（尽量减少线程的等待闲置）

# 轻盈的 “重量级分布式锁”
